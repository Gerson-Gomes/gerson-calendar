// Code generated by cmd/cgo; DO NOT EDIT.

//line /home/omar-gerson/Fullstack/gerson-calendar/src/go/pkg/mod/github.com/wailsapp/wails/v2@v2.11.0/internal/frontend/desktop/linux/invoke.go:1:1
//go:build linux
// +build linux

package linux

/*
#cgo linux pkg-config: gtk+-3.0

#include <stdio.h>
#include "gtk/gtk.h"

extern gboolean invokeCallbacks(void *);

static inline void triggerInvokesOnMainThread() {
    g_idle_add((GSourceFunc)invokeCallbacks, NULL);
}
*/
import _ "unsafe"
import (
	"runtime"
	"sync"
	"unsafe"

	"golang.org/x/sys/unix"
)

var (
	m         sync.Mutex
	mainTid   int
	dispatchq []func()
)

func invokeOnMainThread(f func()) {
	if tryInvokeOnCurrentGoRoutine(f) {
		return
	}

	m.Lock()
	dispatchq = append(dispatchq, f)
	m.Unlock()

	( /*line :42:2*/_Cfunc_triggerInvokesOnMainThread /*line :42:29*/)()
}

func tryInvokeOnCurrentGoRoutine(f func()) bool {
	m.Lock()
	mainThreadID := mainTid
	m.Unlock()

	runtime.LockOSThread()
	defer runtime.UnlockOSThread()

	if mainThreadID != unix.Gettid() {
		return false
	}
	f()
	return true
}

//export invokeCallbacks
func invokeCallbacks(_ unsafe.Pointer)  /*line :61:40*/_Ctype_gboolean /*line :61:50*/ {
	runtime.LockOSThread()
	defer runtime.UnlockOSThread()

	m.Lock()
	if mainTid == 0 {
		mainTid = unix.Gettid()
	}

	q := append([]func(){}, dispatchq...)
	dispatchq = []func(){}
	m.Unlock()

	for _, v := range q {
		v()
	}
	return ( /*line :77:9*/_Ciconst_G_SOURCE_REMOVE /*line :77:25*/)
}
