# Maintainer: Omar Gerson
pkgname=gerson-calendar
pkgver=2.0.0
pkgrel=1
pkgdesc="Local-first offline calendar application with reminders and recurring events"
arch=('x86_64')
url="https://github.com/omar-gerson/gerson-calendar"
license=('MIT')
depends=('webkit2gtk' 'gtk3' 'libnotify')
makedepends=('go' 'nodejs' 'npm' 'gcc')
source=()

build() {
    cd "$srcdir/.."

    # Install frontend dependencies
    cd frontend
    npm install
    cd ..

    # Build with Wails
    if command -v wails &> /dev/null; then
        wails build -clean
    else
        # Fallback: build manually
        cd frontend && npm run build && cd ..
        CGO_ENABLED=1 go build -tags desktop,production -ldflags "-s -w" -o build/bin/gerson-calendar .
    fi
}

package() {
    cd "$srcdir/.."

    # Install binary
    install -Dm755 "build/bin/gerson-calendar" "$pkgdir/usr/bin/gerson-calendar"

    # Install desktop entry
    install -Dm644 "gerson-calendar.desktop" "$pkgdir/usr/share/applications/gerson-calendar.desktop"
}
